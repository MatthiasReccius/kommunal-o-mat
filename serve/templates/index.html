<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Kommunal-O-Mat</title>
  <!-- Einfaches Inline-CSS für eine bessere Lesbarkeit -->
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    form { margin-bottom: 2rem; }
    label { margin-right: 1em; }
    textarea { width: 100%; max-width: 600px; height: 4em; }
    button { margin-top: 1em; padding: 0.5em 1em; }
    h2 { margin-top: 1.5em; }
    details { margin: 0.5em 0 1.5em 0; }
    summary { cursor: pointer; font-weight: bold; }
    blockquote { margin: 0.5em 0 0.5em 1em; padding-left: 0.8em; border-left: 4px solid #ccc; }
  </style>
</head>
<body>
  <h1>Kommunal-O-Mat</h1>
  <p>Geben Sie eine Frage ein und wählen Sie Parteien aus, um relevante Programm-Aussagen zu erhalten.</p>
  <!-- Formular für Frageingabe und Parteienauswahl -->
  <form method="post" action="/">
    <p>
      <label for="question"><strong>Frage stellen:</strong></label><br />
      <textarea id="question" name="question" required>{{ question }}</textarea>
    </p>
    <p><strong>Parteien auswählen:</strong></p>
    <p>
      {% for party in parties %}
        <label>
          <input type="checkbox" name="parties" value="{{ party }}" 
                 {% if party in selected_parties %}checked{% endif %}>
          {{ party }}
        </label>
      {% endfor %}
    </p>
    <button type="submit">Absenden</button>
  </form>

  {% if answers %}
    <!-- Ergebnisse pro Partei ausgeben -->
    {% for ans in answers %}
      <h2>{{ ans.party }}</h2>
      {% if ans.status != "ok" %}
        <!-- Hinweis, falls keine relevanten Passagen gefunden wurden -->
        <p><em>{{ ans.message }}</em></p>
      {% else %}
        <!-- Kurzfazit/Zusammenfassung der gefundenen Passagen -->
        <div>{{ ans.summary | safe }}</div>
        <!-- Ausklappbare Details mit den Original-Zitaten aus dem Programm -->
        <details>
          <summary>'Der Kontext': Wörtliche Auszüge aus dem Parteiprogramm</summary>
          {% for q in ans.quotes %}
            <p><em>Aus dem Kapitel "{{ q.section }}"</em>:</p>
            <blockquote>{{ q.quote }}</blockquote>
          {% endfor %}
        </details>
      {% endif %}
    {% endfor %}
  {% endif %}
</body>
</html>
